/**
 * Deep Checkbox
 * jQuery plugin that brings some logic to nested checkboxes
 * version 0.1.0
 *
 * Copyright (c) Semyon Vyskubov
 * https://github.com/uoziod/deep-checkbox
 *
 * Licensed under the MIT
 */

(function(h){function r(a,c){for(var d=[],k=a.find("ul:first > li"),l=0,q=k.length;l<q;l++){var f=h(k[l]).find("input[type=checkbox]:first"),b=u();f.data("id")||f.data("id",b);f.data("name")||f.data("name",b);b={el:f};if(f=r(h(k[l]),f))b.children=f;c&&(b.parent=c);d.push(b)}return 0<d.length?d:!1}function m(a,c){for(var d=0,k=a.length;d<k;d++)(function(a){h(a.el).on("change",function(){c(a,h(this).prop("checked"))});a.children&&m(a.children,c)})(a[d])}function s(a,c){for(var d=0,k=a.length;d<k;d++)a[d].el.prop("checked",
c),a[d].children&&s(a[d].children,c)}function u(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}var v={listItemBefore:'<span class="item">',listItemAfter:"</span>",listItemsDivider:", ",labelExceptBefore:" (except ",labelExceptAfter:")",labelExceptBetween:", ",labelNothingIsSelected:"Nothing is selected"},t=[];h.fn.deepcheckbox=function(a){if(0>t.indexOf(this.selector)){var c=r(this);m(c,function(a,c){a.children&&
s(a.children,c)});a||(a={});a=h.extend(v,a);a.readableListTarget&&(h(a.readableListTarget).html(a.labelNothingIsSelected),m(c,function(){function d(b,c,f){c||(c=0);for(var e=0,h=b.length;e<h;e++){if(b[e].el.prop("checked")){var g=a.listItemBefore+b[e].el.data("name"),n=0;if(b[e].children){for(var p=0,m=b[e].children.length;p<m;p++)b[e].children[p].el.prop("checked")||(l.push(b[e].children[p].el.data("id")),0===n&&(g+=a.labelExceptBefore),0<n&&(g+=a.labelExceptBetween),g+=b[e].children[p].el.data("name"),
n++);0<n&&(g+=a.labelExceptAfter)}g+=a.listItemAfter;0<c&&b[e].el.prop("checked")&&!b[e].parent.prop("checked")&&(f=!1);if(!f||!b[e].children&&0<n)q.push(g),k.push(b[e].el.data("id"))}b[e].children&&d(b[e].children,c+1,!0)}return q.join(a.listItemsDivider)}var k=[],l=[],q=[],f=d(c);h(a.readableListTarget).html(0<f.length?f:a.labelNothingIsSelected);if(a.onChange&&"function"===typeof a.onChange)a.onChange(k,l)}));t.push(this.selector)}}})(jQuery);
